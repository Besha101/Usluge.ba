<!doctype html>
<html lang="bs">
  <head>
      <!-- Tema: no-flash bootstrap -->
  <script>
    (function() {
      try {
        var key = 'usluge_theme';
        var stored = localStorage.getItem(key);
        var systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = stored || (systemDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      } catch(e) {}
    })();
  </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Usluge.ba</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" href="./style.css" />
    <link href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js"></script>

  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg bg-white nav-shadow sticky-top navbar-compact">
      <div class="container shell">
        <a class="navbar-brand logo pointer" onclick="APP.route('/')">Usluge<span class="dot">.ba</span></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          <form class="d-flex flex-grow-1 gap-2 my-3 my-lg-0 mx-lg-3" onsubmit="APP.searchFromNav(event)">
            <div class="input-group">
              <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
              <input id="navSearch" class="form-control" placeholder="Pretraži usluge i oglase...">
            </div>
          </form>
          <ul class="navbar-nav align-items-lg-center gap-lg-2 me-lg-2" id="authLinks">
            <li class="nav-item"><a class="nav-link" onclick="APP.route('/login')">Prijava</a></li>
            <li class="nav-item"><a class="nav-link" onclick="APP.route('/register')">Registracija</a></li>
          </ul>
          <!-- Prekidač teme (slider) -->
<div class="ms-lg-2">
  <button id="theme-toggle"
          class="theme-toggle"
          aria-label="Promijeni temu"
          aria-pressed="false"
          title="Promijeni temu">
    <span class="toggle-track">
      <span class="toggle-thumb"></span>
    </span>
    <span class="toggle-icons" aria-hidden="true">
      <i class="bi bi-sun icon-sun"></i>
      <i class="bi bi-moon icon-moon"></i>
    </span>
  </button>
</div>


          <div id="userMenu" class="ms-lg-2 hidden d-flex align-items-center">
  <!-- Objavi oglas (sad lijevo) -->
  <a class="btn btn-brand btn-sm text-white d-flex align-items-center" onclick="APP.route('/new')">

    <i class="bi bi-plus-circle me-1"></i> Objavi oglas
  </a>

  <!-- Profilna ikona skroz desno -->
  <div class="dropdown ms-2">


    
      <!-- NAVBAR avatar: default ikonica + opcionalna slika -->
<button class="avatar-btn p-0 border-0 bg-transparent" data-bs-toggle="dropdown" aria-label="Korisnički meni">
  <i id="nav-avatar-icon" class="bi bi-person-circle nav-avatar-icon"></i>
  <img id="nav-avatar" class="rounded-circle profile-outline d-none" alt="profil" width="34" height="34">

</button>

    
    <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" onclick="APP.route('/profile')"><i class="bi bi-person-badge me-2"></i>Moj profil</a></li>
      <li><a class="dropdown-item" onclick="APP.route('/my-listings')"><i class="bi bi-grid me-2"></i>Moji oglasi</a></li>
      <li><a class="dropdown-item" onclick="APP.route('/inbox')"><i class="bi bi-chat-dots me-2"></i>Poruke</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item text-danger" onclick="APP.logout()"><i class="bi bi-box-arrow-right me-2"></i>Odjava</a></li>
    </ul>
  </div>
</div>


        </div>
      </div>
    </nav>

    <main class="py-4">
      <div class="container shell">
        <!-- HOME -->
        <section data-view id="view-home">
          <h3 class="fw-bold mb-3">Kategorije</h3>
          <div id="catGrid" class="row g-3 row-cols-2 row-cols-md-4 row-cols-lg-6"></div>

          <div class="d-flex align-items-center justify-content-between mt-4 mb-2">
            <h3 class="fw-bold mb-0">Istaknuti oglasi</h3>
            <a class="btn btn-sm btn-brand text-white" onclick="APP.route('/new')">
              <i class="bi bi-box-arrow-in-up-right me-1"></i> Objavi oglas
            </a>
          </div>
          <div id="featured" class="row g-3"></div>

          <section class="my-5" id="recenzije">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h3 class="fw-bold mb-0">Šta kažu korisnici</h3>
              <a class="text-decoration-none" onclick="APP.route('/reviews')">Pogledaj sve</a>
            </div>
            <div class="row g-3" id="homeReviews"></div>
          </section>
        </section>

        <!-- AUTH -->
        <section data-view id="view-login" class="hidden">
          <div class="row justify-content-center">
            <div class="col-md-6">
              <div class="card p-3 p-md-4">
                <h4 class="fw-bold">Prijava</h4>
                <form onsubmit="APP.handleLogin(event)" class="mt-3">
                  <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input id="login-email" type="email" class="form-control" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Lozinka</label>
                    <input id="login-pass" type="password" class="form-control" required>
                  </div>
                  <button class="btn btn-brand text-white w-100">Prijavi se</button>
                  <div id="login-error" class="alert alert-danger mt-2 d-none"></div>
                </form>
                <p class="small mt-3">Nemaš račun? <a onclick="APP.route('/register')">Registruj se</a></p>
              </div>
            </div>
          </div>
        </section>

        <section data-view id="view-register" class="hidden">
          <div class="row justify-content-center">
            <div class="col-md-6">
              <div class="card p-3 p-md-4">
                <h4 class="fw-bold">Registracija</h4>
                <form onsubmit="APP.handleRegister(event)" class="mt-3">
                  <div class="mb-3"><label class="form-label">Ime i prezime</label><input id="reg-name" class="form-control" required></div>
                  <div class="mb-3"><label class="form-label">Email</label><input id="reg-email" type="email" class="form-control" required></div>
                  <div class="mb-3"><label class="form-label">Lozinka</label><input id="reg-pass" type="password" class="form-control" minlength="6" required></div>
                  <button class="btn btn-brand text-white w-100">Kreiraj račun</button>
                  <div id="reg-error" class="alert alert-danger mt-2 d-none"></div>
                </form>
              </div>
            </div>
          </div>
        </section>

        <!-- CATEGORY LIST -->
        <section data-view id="view-category" class="hidden">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item pointer" onclick="APP.route('/')">Početna</li>
                <li class="breadcrumb-item active" id="crumbCat">Kategorija</li>
              </ol>
            </nav>
            <small class="text-muted" id="resultCount"></small>
          </div>

          <div class="row g-4">
            <aside class="col-lg-3">
              <div class="sidebar">
                <div class="card"><div class="card-body">
                  <h6 class="mb-3">Filteri</h6>
                  <div class="mb-3">
                    <label class="form-label">Pretraga</label>
                    <input id="f-q" class="form-control" oninput="APP.applyFilters()">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Cijena (BAM)</label>
                    <div class="input-group">
                      <input id="f-min" type="number" class="form-control" placeholder="Min" oninput="APP.applyFilters()">
                      <input id="f-max" type="number" class="form-control" placeholder="Max" oninput="APP.applyFilters()">
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Stanje</label>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="f-novo" onchange="APP.applyFilters()">
                      <label class="form-check-label" for="f-novo">Novo</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="f-kor" onchange="APP.applyFilters()">
                      <label class="form-check-label" for="f-kor">Korišteno</label>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Sortiraj</label>
                    <select id="f-sort" class="form-select" onchange="APP.applyFilters()">
                      <option value="new">Najnovije</option>
                      <option value="cheap">Najjeftinije</option>
                      <option value="exp">Najskuplje</option>
                      <option value="rate">Najbolje ocijenjeno</option>
                    </select>
                  </div>
                </div></div>
              </div>
            </aside>

            <main class="col-lg-9">
              <h3 class="fw-bold mb-3" id="catTitle">Kategorija</h3>
              <div id="listings" class="row g-3"></div>
              <nav class="mt-4"><ul id="pager" class="pagination justify-content-center"></ul></nav>
            </main>
          </div>
        </section>

        <!-- NEW LISTING -->
        <section data-view id="view-new" class="hidden">
          <div class="row justify-content-center">
            <div class="col-lg-8">
              <div class="card p-3 p-md-4">
                <h4 class="fw-bold">Objavi oglas</h4>
                <form onsubmit="APP.submitListing(event)" class="mt-3">
                  <div class="mb-3"><label class="form-label">Naslov</label><input id="new-title" class="form-control" required></div>
                  <div class="mb-3"><label class="form-label">Kategorija</label><select id="new-cat" class="form-select" required></select></div>
                  <div class="mb-3"><label class="form-label">Opis</label><textarea id="new-desc" class="form-control" rows="4" required></textarea></div>
                  <div class="row g-3">
                    <div class="col-md-4"><label class="form-label">Cijena (BAM)</label><input id="new-price" type="number" class="form-control" placeholder="npr. 25"></div>
                    <div class="col-md-4"><label class="form-label">Na upit</label><div class="form-check"><input id="new-poa" class="form-check-input" type="checkbox"></div></div>
                    <div class="col-md-4"><label class="form-label">Grad</label><input id="new-city" class="form-control" placeholder="npr. Sarajevo"></div>
                  </div>
                  <div class="mb-3 mt-3">
                    <label class="form-label">Fotografije rada (max 6)</label>
                    <input id="new-photos" type="file" class="form-control" accept="image/*" multiple>
                  </div>
                  <button class="btn btn-brand text-white">Objavi</button>
                </form>
              </div>
            </div>
          </div>
        </section>

        <!-- LISTING DETAILS -->
        <section data-view id="view-listing" class="hidden">
          <div class="row g-4">
            <div class="col-lg-8">
              <div class="card">
                <div id="gallery" class="carousel slide" data-bs-ride="false">
                  <div class="carousel-inner" id="galleryInner"></div>
                  <button class="carousel-control-prev" type="button" data-bs-target="#gallery" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#gallery" data-bs-slide="next">
                    <span class="carousel-control-next-icon"></span>
                  </button>
                </div>
                <div class="card-body">
                  <h3 id="l-title" class="fw-bold mb-1">Naslov</h3>
                  <div class="d-flex align-items-center gap-2 mb-2">
                    <span class="badge badge-cat" id="l-cat">Kategorija</span>
                    <span class="text-muted" id="l-city"></span>
                  </div>
                  <div class="d-flex align-items-center justify-content-between mb-3">
                    <div>
                      <div class="h4 mb-0" id="l-price"></div>
                      <small class="text-muted" id="l-upit"></small>
                    </div>
                    <div class="rating" id="l-rating"></div>
                  </div>
                  <p id="l-desc" class="mb-0"></p>
                </div>
              </div>

              <!-- Reviews -->
              <div class="card mt-3">
                <div class="card-body">
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <h5 class="fw-bold mb-0">Recenzije</h5>
                    <span class="text-muted small" id="revCount"></span>
                  </div>
                  <div id="revList" class="vstack gap-3"></div>

                  <hr class="my-3">
                  <form onsubmit="APP.submitReview(event)" id="revForm" class="mt-2">
                    <div class="row g-2 align-items-center">
                      <div class="col-md-2">
                        <label class="form-label mb-0">Ocjena</label>
                        <select id="revRating" class="form-select" required>
                          <option value="5">5</option><option value="4">4</option><option value="3">3</option>
                          <option value="2">2</option><option value="1">1</option>
                        </select>
                      </div>
                      <div class="col-md-8">
                        <label class="form-label mb-0">Komentar</label>
                        <input id="revText" class="form-control" placeholder="Napiši iskustvo" required>
                      </div>
                      <div class="col-md-2 d-grid">
                        <button class="btn btn-brand text-white mt-4">Objavi</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Seller + Chat -->
            <div class="col-lg-4">
              <div class="card">
                <div class="card-body d-flex gap-3 align-items-center">
                  <img id="s-avatar" src="https://i.pravatar.cc/100?img=15" class="rounded-circle" width="56" height="56" alt="avatar"/>
                  <div>
                    <div id="s-name" class="fw-bold">Ime prodavača</div>
                    <a class="small" id="s-profile" onclick="APP.openSellerProfile()">Pogledaj profil</a>
                  </div>
                </div>
                <div class="card-body border-top">
                  <p id="s-bio" class="small mb-3">Kratka biografija majstora/usluga.</p>
                  <button class="btn btn-outline-primary w-100" onclick="APP.startChat()">
                    <i class="bi bi-chat-dots me-1"></i> Pošalji poruku
                  </button>
                </div>
              </div>

              <div class="card mt-3">
                <div class="card-body">
                  <h6 class="fw-bold">Privatni chat</h6>
                  <div id="chatBox" class="chat-box p-2 mb-2"></div>
                  <form onsubmit="APP.sendChat(event)" class="d-flex gap-2">
                    <input id="chatInput" class="form-control" placeholder="Napiši poruku..."/>
                    <button class="btn btn-brand text-white"><i class="bi bi-send"></i></button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- PROFILE -->
        <section data-view id="view-profile" class="hidden">
          <div class="card p-3 p-md-4">
            <div class="d-flex align-items-start gap-4 flex-wrap">

  <!-- Lijevo: slika + ime + email (ime i email ISPOD slike) -->
  <div class="d-flex flex-column align-items-center text-center" style="min-width:220px;">
    <div id="p-avatar-wrap" class="position-relative mb-2">
  <img id="p-avatar" class="rounded-circle d-none profile-outline" width="120" height="120" alt="avatar">
  <i id="p-avatar-icon" class="bi bi-person-circle avatar-icon" aria-hidden="true"></i>

  <!-- Hover overlay (kamera) -->
  <div id="avatar-overlay" class="avatar-overlay">
    <i class="bi bi-camera-fill"></i>
  </div>

  <input id="p-photo" type="file" accept="image/*" class="d-none">
</div>


    <div class="mt-1">
      <h4 id="p-name" class="fw-bold mb-0">Ime korisnika</h4>
      <div id="p-email" class="text-muted small">email@example.com</div>
    </div>
  </div>

  <!-- Desno: forma ostalih polja (ostaje kao što je ispod) -->
  <div class="flex-grow-1">
    <div class="row g-3 mt-1">
      <div class="col-md-8">
        <label class="form-label">Kratka biografija</label>
        <textarea id="p-bio" class="form-control" rows="4" placeholder="Napiši ko si i čime se baviš..."></textarea>
      </div>
      <div class="col-md-4">
        <label class="form-label">Grad</label>
        <input id="p-city" class="form-control" placeholder="npr. Sarajevo">
        <label class="form-label mt-3">Kontakt telefon</label>
        <input id="p-phone" class="form-control" placeholder="npr. 061 123 456">
        <button class="btn btn-brand text-white w-100 mt-3" onclick="APP.saveProfile()">Spasi profil</button>
      </div>
    </div>
  </div>

</div>

        </section>

        <!-- INBOX -->
        <section data-view id="view-inbox" class="hidden">
          <div class="row g-3">
            <div class="col-lg-4">
              <div class="card"><div class="list-group list-group-flush" id="threadList"></div></div>
            </div>
            <div class="col-lg-8">
              <div class="card p-3">
                <div id="threadTitle" class="fw-bold mb-2">Odaberi razgovor</div>
                <div id="threadBox" class="chat-box p-2 mb-2"></div>
                <form onsubmit="APP.sendThread(event)" class="d-flex gap-2">
                  <input id="threadInput" class="form-control" placeholder="Poruka..."/>
                  <button class="btn btn-brand text-white"><i class="bi bi-send"></i></button>
                </form>
              </div>
            </div>
          </div>
        </section>

      </div>
    </main>

    <footer class="bg-white border-top py-4">
      <div class="container shell d-flex flex-wrap justify-content-between align-items-center gap-2">
        <small class="text-muted">© <span id="year"></span> Usluge.ba</small>
        <ul class="nav small">
          <li class="nav-item"><a class="nav-link px-2 text-muted">O nama</a></li>
          <li class="nav-item"><a class="nav-link px-2 text-muted">Kontakt</a></li>
          <li class="nav-item"><a class="nav-link px-2 text-muted">Uslovi korištenja</a></li>
        </ul>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JS app -->
    <script type="module" src="./app.js"></script>
    
    <script>
  (function(){
    const html = document.documentElement;
    const btn = document.getElementById('theme-toggle');
    const STORAGE_KEY = 'usluge_theme';

    function setTheme(theme, animate = true){
      html.setAttribute('data-theme', theme);
      localStorage.setItem(STORAGE_KEY, theme);
      if(animate){
        html.classList.add('theme-animating');
        setTimeout(()=>html.classList.remove('theme-animating'), 300);
      }
    }

    const stored = localStorage.getItem(STORAGE_KEY);
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const initial = stored || (systemDark ? 'dark' : 'light');
    setTheme(initial, false);

    btn?.addEventListener('click', ()=>{
      const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      setTheme(next, true);
    });
  })();
</script>


  </body>
</html>